{% extends 'partials/admin_base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<style>
    body {
        margin: 20;
        height: 100vh;
        display: flex;
        flex-direction: column;
        font-family: Arial, sans-serif;
        background:rgb(255, 255, 255);
       
    }
    .main{
 
    margin-left:220px;
    margin-top:60px;
}
@media screen and (max-width: 1024px) {
    .main {
        flex-grow: 1;
        margin-left: 0px; /* No left margin on mobile */
    }
}

    h1 {
        padding: 30px;
        margin: 0;
        background: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        flex-shrink: 0;
        color: #2c3e50;
        font-size: 24px;
        text-align: center;
    }

    .chart-container {
        flex-grow: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center; /* Centers charts on small screens */
        gap: 20px;
        align-content: flex-start;
        max-height: 80vh;
        padding-bottom: 50px; /* Add padding to prevent overlap */
    }

    .chart-box {
        flex: 1 1 400px;
        height: 400px;
        min-width: 300px;
        max-width: 100%; /* Ensures it doesn't overflow on small screens */
        background: #fff;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }

    .chart-box:hover {
        transform: translateY(-5px);
    }

    /* Responsive Design for Mobile */
    @media (max-width: 768px) {
        .chart-container {
            flex-direction: column; /* Stack charts vertically */
            align-items: center; /* Center charts */
        }

        .chart-box {
            width: 90%; /* Make charts take full width */
            height: auto;
            min-width: unset; /* Reset min-width for better fit */
        }
    }
    html, body {
        height: 100%;
        margin: 0;
        display: flex;
        flex-direction: column;
    }
    
    .main {
        flex-grow: 1; /* This ensures the main content expands */
        {% comment %} margin-left: 220px;
        margin-top: 60px; {% endcomment %}
    }
    
    .chart-container {
        flex-grow: 1;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        align-content: flex-start;
        overflow-y: auto;
        padding-bottom: 50px; /* Add padding to prevent overlap */
    }
    
    /* Footer Styling */
    footer {
        text-align: center;
        padding: 10px;
        background: #f8f9fa;
        position: relative;
        width: 100%;
        bottom: 0;
    }
    
</style>

<div class="main chart-container">
    <div class="chart-box" id="blog-status-chart"></div>
    <div class="chart-box" id="category-chart"></div>
    <div class="chart-box" id="top-authors-chart"></div>
    <div class="chart-box" id="likes-dislikes-chart"></div>
</div>

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Blog Status Distribution
        Highcharts.chart("blog-status-chart", {
            chart: { type: 'pie' },
            title: { text: 'Blog Status Distribution' },
            series: [{
                name: 'Blogs',
                data: [
                    {% for item in blog_status_data %}
                    { name: "{{ item.status }}", y: {{ item.count }} },
                    {% endfor %}
                ]
            }]
        });

        // Blogs Per Category
        Highcharts.chart("category-chart", {
            chart: { type: 'column' },
            title: { text: 'Number of Blogs per Category' },
            xAxis: { categories: [{% for item in category_data %}"{{ item.category__name }}",{% endfor %}] },
            yAxis: { title: { text: 'Number of Blogs' } },
            series: [{
                name: 'Blogs',
                data: [{% for item in category_data %}{{ item.count }},{% endfor %}]
            }]
        });

        // Top Authors
        Highcharts.chart("top-authors-chart", {
            chart: { type: 'bar' },
            title: { text: 'Top 5 Authors by Blog Count' },
            xAxis: { categories: [{% for author in top_authors %}"{{ author.author__username }}",{% endfor %}] },
            yAxis: { title: { text: 'Number of Blogs' } },
            series: [{
                name: 'Blogs',
                data: [{% for author in top_authors %}{{ author.count }},{% endfor %}]
            }]
        });

        // Likes vs Dislikes
        Highcharts.chart("likes-dislikes-chart", {
            chart: { type: 'bar' },
            title: { text: 'Likes vs Dislikes' },
            xAxis: { categories: ['Likes', 'Dislikes'] },
            series: [{
                name: 'Reactions',
                data: [{{ total_likes }}, {{ total_dislikes }}]
            }]
        });

    });
</script>

{% endblock content %}
